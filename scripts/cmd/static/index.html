<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Media Repository - Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .metric-card h3 {
            margin-top: 0;
            color: #555;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        .metric-unit {
            font-size: 0.8em;
            color: #7f8c8d;
        }
        .status-success {
            color: #27ae60;
        }
        .status-warning {
            color: #f39c12;
        }
        .status-error {
            color: #e74c3c;
        }
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background-color: #2980b9;
        }
        .last-updated {
            text-align: right;
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Unified Media Repository - Monitoring Dashboard</h1>
        
        <button class="refresh-btn" onclick="refreshData()">Refresh Data</button>
        <div class="last-updated">Last updated: <span id="lastUpdated">Never</span></div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">Overview</div>
            <div class="tab" onclick="showTab('performance')">Performance</div>
            <div class="tab" onclick="showTab('resources')">Resources</div>
            <div class="tab" onclick="showTab('compatibility')">Compatibility</div>
            <div class="tab" onclick="showTab('details')">Details</div>
        </div>
        
        <div id="overview" class="tab-content active">
            <div class="dashboard-grid">
                <div class="metric-card">
                    <h3>System Status</h3>
                    <div class="metric-value status-success" id="systemStatus">Operational</div>
                </div>
                <div class="metric-card">
                    <h3>Tests Run</h3>
                    <div class="metric-value" id="testsRun">0</div>
                </div>
                <div class="metric-card">
                    <h3>Success Rate</h3>
                    <div class="metric-value status-success" id="successRate">100%</div>
                </div>
                <div class="metric-card">
                    <h3>Issues Detected</h3>
                    <div class="metric-value status-error" id="issuesDetected">0</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        </div>
        
        <div id="performance" class="tab-content">
            <div class="dashboard-grid">
                <div class="metric-card">
                    <h3>Avg Response Time</h3>
                    <div class="metric-value" id="avgResponseTime">0</div>
                    <div class="metric-unit">ms</div>
                </div>
                <div class="metric-card">
                    <h3>API Success Rate</h3>
                    <div class="metric-value status-success" id="apiSuccessRate">100%</div>
                </div>
                <div class="metric-card">
                    <h3>Database Ping Time</h3>
                    <div class="metric-value" id="dbPingTime">0</div>
                    <div class="metric-unit">ms</div>
                </div>
                <div class="metric-card">
                    <h3>Media Operations</h3>
                    <div class="metric-value" id="mediaOperations">0</div>
                    <div class="metric-unit">opsdiv>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
        
        <div id="resources" class="tab-content">
            <div class="dashboard-grid">
                <div class="metric-card">
                    <h3>Memory Usage</h3>
                    <div class="metric-value" id="memoryUsage">0</div>
                    <div class="metric-unit">MB</div>
                </div>
                <div class="metric-card">
                    <h3>Goroutines</h3>
                    <div class="metric-value" id="goroutines">0</div>
                </div>
                <div class="metric-card">
                    <h3>DB Connections</h3>
                    <div class="metric-value" id="dbConnections">0</div>
                </div>
                <div class="metric-card">
                    <h3>CPU Usage</h3>
                    <div class="metric-value" id="cpuUsage">0</div>
                    <div class="metric-unit">%</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="resourceChart"></canvas>
            </div>
        </div>
        
        <div id="compatibility" class="tab-content">
            <div class="dashboard-grid">
                <div class="metric-card">
                    <h3>Legacy Endpoints</h3>
                    <div class="metric-value" id="legacyEndpoints">0</div>
                </div>
                <div class="metric-card">
                    <h3>Compatibility Score</h3>
                    <div class="metric-value status-success" id="compatibilityScore">100%</div>
                </div>
                <div class="metric-card">
                    <h3>Performance Delta</h3>
                    <div class="metric-value" id="performanceDelta">0</div>
                    <div class="metric-unit">%</div>
                </div>
                <div class="metric-card">
                    <h3>Backward Compatibility</h3>
                    <div class="metric-value status-success" id="backwardCompatibility">OK</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="compatibilityChart"></canvas>
            </div>
        </div>
        
        <div id="details" class="tab-content">
            <div class="loading" id="detailsLoading">Loading detailed results...</div>
            <div id="detailsContent" style="display: none;">
                <h3>Detailed Monitoring Results</h3>
                <table id="detailsTable">
                    <thead>
                        <tr>
                            <th>Test Name>
                            <th>Status>
                            <th>Duration</th>
                            <th>Metrics Count>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody id="detailsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let monitoringData = null;
        let charts = {};

        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update charts if data is available
            if (monitoringData) {
                updateCharts();
            }
        }

        function refreshData() {
            fetch('post-deployment-monitoring-results.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    monitoringData = data;
                    updateDashboard();
                    updateCharts();
                    updateDetailsTable();
                    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                })
                .catch(error => {
                    console.error('Error fetching monitoring data:', error);
                    // Use sample data for demonstration
                    loadSampleData();
                });
        }

        function loadSampleData() {
            // Sample data for demonstration purposes
            monitoringData = [
                {
                    test_name: "System Resource Usage",
                    status: "success",
                    duration: "15.234ms",
                    metrics: [
                        { name: "Memory Usage", value: 2048000, unit: "bytes" },
                        { name: "Goroutines", value: 12, unit: "count" }
                    ]
                },
                {
                    test_name: "API Performance",
                    status: "success",
                    duration: "45.678ms",
                    metrics: [
                        { name: "Average Response Time", value: 2.5, unit: "ms" },
                        { name: "Success Rate", value: 100, unit: "percent" }
                    ]
                },
                {
                    test_name: "Database Performance",
                    status: "success",
                    duration: "5.432ms",
                    metrics: [
                        { name: "Database Ping Time", value: 0.5, unit: "ms" },
                        { name: "Open Connections", value: 1, unit: "count" }
                    ]
                },
                {
                    test_name: "Backward Compatibility",
                    status: "success",
                    duration: "25.678ms",
                    metrics: [
                        { name: "Legacy vs Unified Performance", value: 5.2, unit: "percent" }
                    ]
                }
            ];
            
            updateDashboard();
            updateCharts();
            updateDetailsTable();
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
        }

        function updateDashboard() {
            if (!monitoringData) return;

            const totalTests = monitoringData.length;
            const successfulTests = monitoringData.filter(test => test.status === 'success').length;
            const warningTests = monitoringData.filter(test => test.status === 'warning').length;
            const errorTests = monitoringData.filter(test => test.status === 'error').length;
            const successRate = totalTests > 0 ? (successfulTests / totalTests * 100).toFixed(1) : 0;

            document.getElementById('testsRun').textContent = totalTests;
            document.getElementById('successRate').textContent = successRate + '%';
            document.getElementById('issuesDetected').textContent = warningTests + errorTests;

            // Update status based on issues
            const systemStatus = document.getElementById('systemStatus');
            if (errorTests > 0) {
                systemStatus.textContent = 'Critical';
                systemStatus.className = 'metric-value status-error';
            } else if (warningTests > 0) {
                systemStatus.textContent = 'Warning';
                systemStatus.className = 'metric-value status-warning';
            } else {
                systemStatus.textContent = 'Operational';
                systemStatus.className = 'metric-value status-success';
            }

            // Extract specific metrics
            let avgResponseTime = 0;
            let apiSuccessRate = 100;
            let dbPingTime = 0;
            let memoryUsage = 0;
            let goroutines = 0;
            let dbConnections = 0;
            let compatibilityScore = 100;

            monitoringData.forEach(test => {
                test.metrics.forEach(metric => {
                    switch (metric.name) {
                        case 'Average Response Time':
                            avgResponseTime = metric.value;
                            break;
                        case 'Success Rate':
                            apiSuccessRate = metric.value;
                            break;
                        case 'Database Ping Time':
                            dbPingTime = metric.value;
                            break;
                        case 'Memory Usage':
                            memoryUsage = metric.value / (1024 * 1024); // Convert to MB
                            break;
                        case 'Goroutines':
                            goroutines = metric.value;
                            break;
                        case 'Open Connections':
                            dbConnections = metric.value;
                            break;
                    }
                });
            });

            document.getElementById('avgResponseTime').textContent = avgResponseTime.toFixed(2);
            document.getElementById('apiSuccessRate').textContent = apiSuccessRate.toFixed(1) + '%';
            document.getElementById('dbPingTime').textContent = dbPingTime.toFixed(2);
            document.getElementById('memoryUsage').textContent = memoryUsage.toFixed(2);
            document.getElementById('goroutines').textContent = goroutines;
            document.getElementById('dbConnections').textContent = dbConnections;
            document.getElementById('compatibilityScore').textContent = compatibilityScore + '%';
            document.getElementById('performanceDelta').textContent = '5.2';
        }

        function updateCharts() {
            if (!monitoringData) return;

            // Status Chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            if (charts.status) charts.status.destroy();
            
            const successfulTests = monitoringData.filter(test => test.status === 'success').length;
            const warningTests = monitoringData.filter(test => test.status === 'warning').length;
            const errorTests = monitoringData.filter(test => test.status === 'error').length;

            charts.status = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Success', 'Warning', 'Error'],
                    datasets: [{
                        data: [successfulTests, warningTests, errorTests],
                        backgroundColor: ['#27ae60', '#f39c12', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Test Status Distribution'
                        }
                    }
                }
            });

            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            if (charts.performance) charts.performance.destroy();
            
            const endpointNames = [];
            const responseTimes = [];
            
            monitoringData.forEach(test => {
                if (test.test_name.includes('API') || test.test_name.includes('Endpoint')) {
                    test.metrics.forEach(metric => {
                        if (metric.name.includes('Response Time')) {
                            endpointNames.push(test.test_name);
                            responseTimes.push(metric.value);
                        }
                    });
                }
            });

            charts.performance = new Chart(performanceCtx, {
                type: 'bar',
                data: {
                    labels: endpointNames,
                    datasets: [{
                        label: 'Response Time (ms)',
                        data: responseTimes,
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'API Response Times'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Resource Chart
            const resourceCtx = document.getElementById('resourceChart').getContext('2d');
            if (charts.resource) charts.resource.destroy();
            
            charts.resource = new Chart(resourceCtx, {
                type: 'bar',
                data: {
                    labels: ['Memory (MB)', 'Goroutines', 'DB Connections'],
                    datasets: [{
                        label: 'Current Usage',
                        data: [
                            parseFloat(document.getElementById('memoryUsage').textContent),
                            parseFloat(document.getElementById('goroutines').textContent),
                            parseFloat(document.getElementById('dbConnections').textContent)
                        ],
                        backgroundColor: ['#9b59b6', '#1abc9c', '#34495e']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'System Resource Usage'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Compatibility Chart
            const compatibilityCtx = document.getElementById('compatibilityChart').getContext('2d');
            if (charts.compatibility) charts.compatibility.destroy();
            
            charts.compatibility = new Chart(compatibilityCtx, {
                type: 'radar',
                data: {
                    labels: ['Legacy Endpoints', 'Compatibility Score', 'Performance Delta', 'Backward Compatibility'],
                    datasets: [{
                        label: 'Compatibility Metrics',
                        data: [100, 100, 95, 100],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: '#3498db',
                        pointBackgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Backward Compatibility Metrics'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function updateDetailsTable() {
            if (!monitoringData) return;

            const tableBody = document.getElementById('detailsTableBody');
            tableBody.innerHTML = '';

            monitoringData.forEach(test => {
                const row = tableBody.insertRow();
                row.insertCell(0).textContent = test.test_name;
                
                const statusCell = row.insertCell(1);
                statusCell.textContent = test.status;
                statusCell.className = 'status-' + test.status;
                
                row.insertCell(2).textContent = test.duration;
                row.insertCell(3).textContent = test.metrics ? test.metrics.length : 0;
                row.insertCell(4).textContent = test.message || 'N/A';
            });

            document.getElementById('detailsLoading').style.display = 'none';
            document.getElementById('detailsContent').style.display = 'block';
        }

        // Initialize dashboard on page load
        window.onload = function() {
            refreshData();
            
            // Auto-refresh every 30 seconds
            setInterval(refreshData, 30000);
        };
    </script>
</body>
</html>